{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h2>Bot Status</h2>
    <div class="status-card">
        <p>Current Status: <strong>{{ config.status }}</strong></p>
        <p>Trading Enabled: {{ 'Yes' if config.trading_enabled else 'No' }}</p>
        <p>Last Trade: {{ config.last_trade_time | timestamp_to_datetime }}</p>
        <p>Error Count: {{ config.error_count }}</p>
        <p>Last Error: {{ config.last_error }}</p>
    </div>
    
    <div class="actions">
        {% if not config.trading_enabled %}
        <button onclick="startBot()">Start Bot</button>
        {% else %}
        <button onclick="stopBot()">Stop Bot</button>
        {% endif %}
        <button onclick="resetBot()">Reset Bot</button>
        <a href="{{ url_for('config') }}">Configure</a>
    </div>
    
    <h2>Market Analysis</h2>
    <div id="analysis-data">
        <p>Loading analysis data...</p>
    </div>
</div>

<script>
function startBot() {
    fetch('/start')
        .then(response => response.json())
        .then(data => {
            alert(data.status);
            location.reload();
        });
}

function stopBot() {
    fetch('/stop')
        .then(response => response.json())
        .then(data => {
            alert(data.status);
            location.reload();
        });
}

function resetBot() {
    fetch('/reset')
        .then(response => response.json())
        .then(data => {
            alert(data.status);
            location.reload();
        });
}

// Fetch analysis data periodically
setInterval(function() {
    fetch('/status')
        .then(response => response.json())
        .then(data => {
            let analysis = data.analysis;
            let html = `
                <h3>Stochastic Oscillator</h3>
                <p>K: ${analysis.stochastic.k.toFixed(2)}%, D: ${analysis.stochastic.d.toFixed(2)}%</p>
                <h3>RSI</h3>
                <p>${analysis.rsi.toFixed(2)}%</p>
                <h3>Moving Averages</h3>
                <p>Short (${config.moving_avg_short}): ${analysis.moving_averages.short.toFixed(5)}</p>
                <p>Long (${config.moving_avg_long}): ${analysis.moving_averages.long.toFixed(5)}</p>
                <h3>Market Sentiment</h3>
                <p>${analysis.sentiment}</p>
                <h3>Trading Signal</h3>
                <p>${analysis.signal}</p>
            `;
            document.getElementById('analysis-data').innerHTML = html;
        });
}, 30000); // Update every 30 seconds
</script>

{% endblock %}
