<!DOCTYPE html>
<html>
<head>
    <title>üìà –ë–æ—Ç BingX Spot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; padding: 10px; background: #f0f2f5; }
        .container { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1890ff; font-size: 1.2rem; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        select, input, button { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        button { background: #1890ff; color: white; font-weight: bold; border: none; cursor: pointer; }
        button:hover { background: #0c7cd5; }
        .status-card { background: #fafafa; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .toggle-group { display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; padding: 10px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div id="auth">
            <h3 style="text-align:center;">üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h3>
            <input type="password" id="pwd" placeholder="–ü–∞—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞" autocomplete="current-password">
            <button onclick="login()" style="margin-top: 10px;">–í–æ–π—Ç–∏</button>
        </div>

        <div id="main" style="display:none;">
            <h1>ü§ñ –ë–æ—Ç BingX Spot</h1>
            
            <div class="form-group">
                <label>–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞:</label>
                <select id="pair">
                    <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
                </select>
            </div>

            <div class="form-group">
                <label>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</label>
                <select id="strategy">
                    <option value="stochastic">–°—Ç–æ—Ö–∞—Å—Ç–∏–∫</option>
                    <option value="rsi">RSI</option>
                    <option value="combo">–ö–æ–º–±–æ (3 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞)</option>
                </select>
            </div>

            <div class="form-group">
                <label>–†–∏—Å–∫ (1-10): <span id="riskVal">5</span></label>
                <input type="range" id="risk" min="1" max="10" value="5">
            </div>

            <div class="toggle-group">
                <span>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 200+ –ø–∞—Ä</span>
                <input type="checkbox" id="scanAll" checked>
            </div>

            <button onclick="saveSettings()" style="background:#52c41a; margin-top: 10px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button onclick="tradeNow()" style="background:#faad14; margin-top: 10px;">‚ö° –¢–æ—Ä–≥–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å</button>

            <div class="status-card">
                <h3 style="font-size: 1rem;">üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                <div><strong>–ê–Ω–∞–ª–∏–∑:</strong> <span id="analysisStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span></div>
                <div><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª:</strong> <span id="lastSignal">-</span></div>
                <div><strong>–¶–µ–Ω–∞:</strong> <span id="price">-</span></div>
                <div><strong>–ë–∞–ª–∞–Ω—Å:</strong> <span id="balance">-</span></div>
                <div><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span id="lastUpdate">-</span></div>
            </div>
        </div>
    </div>

    <script>
        let token = null;
        const pairs = [
            "BTC-USDT", "ETH-USDT", "BNB-USDT", "SOL-USDT", "XRP-USDT", "USDC-USDT", "ADA-USDT", "DOGE-USDT", "TRX-USDT", "TON-USDT",
            "AVAX-USDT", "SHIB-USDT", "LINK-USDT", "BCH-USDT", "DOT-USDT", "LTC-USDT", "NEAR-USDT", "MATIC-USDT", "ICP-USDT", "APT-USDT",
            "UNI-USDT", "STX-USDT", "FET-USDT", "RNDR-USDT", "ATOM-USDT", "IMX-USDT", "INJ-USDT", "OP-USDT", "HBAR-USDT", "TIA-USDT",
            "RUNE-USDT", "AR-USDT", "MKR-USDT", "SUI-USDT", "SEI-USDT", "AAVE-USDT", "GRT-USDT", "FIL-USDT", "LDO-USDT", "MINA-USDT",
            "ALGO-USDT", "EGLD-USDT", "FLOW-USDT", "QNT-USDT", "AXS-USDT", "MANA-USDT", "SAND-USDT", "THETA-USDT", "VET-USDT", "XLM-USDT",
            "EOS-USDT", "XTZ-USDT", "KAVA-USDT", "GALA-USDT", "DYDX-USDT", "CRV-USDT", "SNX-USDT", "KSM-USDT", "ZIL-USDT", "CHZ-USDT",
            "ENJ-USDT", "BAT-USDT", "ZEC-USDT", "DASH-USDT", "NEXO-USDT", "COMP-USDT", "YFI-USDT", "CAKE-USDT", "1INCH-USDT", "LRC-USDT",
            "OMG-USDT", "CELO-USDT", "AMP-USDT", "ANKR-USDT", "AUDIO-USDT", "BAND-USDT", "BLZ-USDT", "C98-USDT", "CTSI-USDT", "CVC-USDT",
            "DGB-USDT", "DNT-USDT", "ELF-USDT", "FLUX-USDT", "FTM-USDT", "FXS-USDT", "GAS-USDT", "GLMR-USDT", "GMT-USDT", "GODS-USDT",
            "HIGH-USDT", "HNT-USDT", "ICX-USDT", "IOST-USDT", "IOTA-USDT", "JASMY-USDT", "JOE-USDT", "JST-USDT", "KDA-USDT", "KLAY-USDT",
            "LINA-USDT", "LOKA-USDT", "LPT-USDT", "LQTY-USDT", "LUNA-USDT", "MASK-USDT", "MDT-USDT", "METIS-USDT", "MOVR-USDT", "MTL-USDT",
            "NKN-USDT", "OCEAN-USDT", "OGN-USDT", "ONT-USDT", "ORN-USDT", "OXT-USDT", "PERP-USDT", "PHA-USDT", "PIVX-USDT", "POLY-USDT",
            "POWR-USDT", "PYR-USDT", "QI-USDT", "QTUM-USDT", "RAD-USDT", "REEF-USDT", "REN-USDT", "REQ-USDT", "RLC-USDT", "RSR-USDT",
            "RVN-USDT", "SFP-USDT", "SKL-USDT", "SLP-USDT", "SNM-USDT", "SNT-USDT", "STORJ-USDT", "SUSHI-USDT", "SXP-USDT", "TFUEL-USDT",
            "TOMO-USDT", "TRB-USDT", "TUSD-USDT", "UMA-USDT", "UTK-USDT", "VTHO-USDT", "WAVES-USDT", "WAXP-USDT", "WOO-USDT", "XEM-USDT",
            "XMR-USDT", "XNO-USDT", "XVS-USDT", "YGG-USDT", "ZRX-USDT", "ACH-USDT", "AGLD-USDT", "AKRO-USDT", "ALCX-USDT", "ALICE-USDT",
            "ALPHA-USDT", "ARPA-USDT", "ASTR-USDT", "ATA-USDT", "AUCTION-USDT", "BADGER-USDT", "BAL-USDT", "BICO-USDT", "BOND-USDT",
            "BSW-USDT", "BURGER-USDT", "CELR-USDT", "CHESS-USDT", "CHR-USDT", "CLV-USDT", "COTI-USDT", "CRO-USDT", "CTK-USDT", "DAR-USDT",
            "DENT-USDT", "DEXE-USDT", "DIA-USDT", "DODO-USDT", "DREP-USDT", "DUSK-USDT", "EDU-USDT", "EFI-USDT", "ELON-USDT", "ERN-USDT",
            "FIDA-USDT", "FLM-USDT", "FOR-USDT", "FRONT-USDT", "FUN-USDT", "GHST-USDT", "GLM-USDT", "GNS-USDT", "GTC-USDT", "HARD-USDT",
            "HERO-USDT", "HOT-USDT", "IDEX-USDT", "ILV-USDT", "IOTX-USDT", "IRIS-USDT", "JUV-USDT", "KNC-USDT", "KP3R-USDT", "LAZIO-USDT",
            "LIT-USDT", "MAGIC-USDT", "MBL-USDT", "MIR-USDT", "NBS-USDT", "NMR-USDT", "OM-USDT", "OOKI-USDT", "PARA-USDT", "PAXG-USDT",
            "PEOPLE-USDT", "PERL-USDT", "PLA-USDT", "PNT-USDT", "PROS-USDT", "PUNDIX-USDT", "QLC-USDT", "RARE-USDT", "RAY-USDT", "ROSE-USDT",
            "SPELL-USDT", "SRM-USDT", "STMX-USDT", "STPT-USDT", "STRAX-USDT", "SUN-USDT", "SYS-USDT", "TCT-USDT", "TKO-USDT", "TLM-USDT",
            "TVK-USDT", "UFT-USDT", "UNFI-USDT", "VGX-USDT", "VIB-USDT", "VIDT-USDT", "VITE-USDT", "VOXEL-USDT", "WAN-USDT", "WING-USDT",
            "WNXM-USDT", "WRX-USDT", "ZEN-USDT"
        ];

        document.getElementById('risk').addEventListener('input', e => {
            document.getElementById('riskVal').textContent = e.target.value;
        });

        function populatePairs() {
            const select = document.getElementById('pair');
            pairs.forEach(pair => {
                const opt = document.createElement('option');
                opt.value = pair;
                opt.textContent = pair;
                select.appendChild(opt);
            });
        }

        async function login() {
            const pwd = document.getElementById('pwd').value;
            if (!pwd) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                return;
            }
            try {
                const res = await fetch('/api/bot/status', {
                    headers: { 'Authorization': `Bearer ${pwd}` }
                });
                if (res.ok) {
                    token = pwd;
                    document.getElementById('auth').style.display = 'none';
                    document.getElementById('main').style.display = 'block';
                    populatePairs();
                    loadStatus();
                    setInterval(loadStatus, 10000);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                }
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + e.message);
            }
        }

        async function loadStatus() {
            try {
                const res = await fetch('/api/bot/status', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.success) {
                    const s = data.data;
                    document.getElementById('lastSignal').textContent = s.settings.lastSignal || 'NEUTRAL';
                    document.getElementById('price').textContent = s.currentPrice || 'N/A';
                    document.getElementById('balance').textContent = s.availableBalance || 'N/A';
                    document.getElementById('lastUpdate').textContent = s.lastUpdate ? new Date(s.lastUpdate).toLocaleTimeString() : '–ù–∏–∫–æ–≥–¥–∞';
                    document.getElementById('analysisStatus').textContent = s.settings.scanAllPairs ? '–°–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –ø–∞—Ä—ã' : '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞—Ä—É';
                    document.getElementById('scanAll').checked = s.settings.scanAllPairs;
                    document.getElementById('pair').value = s.settings.tradingPair;
                    document.getElementById('strategy').value = s.settings.strategy;
                    document.getElementById('risk').value = s.settings.riskLevel;
                    document.getElementById('riskVal').textContent = s.settings.riskLevel;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', e);
            }
        }

        async function saveSettings() {
            const settings = {
                tradingPair: document.getElementById('pair').value,
                strategy: document.getElementById('strategy').value,
                riskLevel: parseInt(document.getElementById('risk').value),
                scanAllPairs: document.getElementById('scanAll').checked
            };
            try {
                const res = await fetch('/api/bot/settings', {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`, 
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(settings)
                });
                const result = await res.json();
                if (result.success) {
                    alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    loadStatus();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (e) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message);
            }
        }

        async function tradeNow() {
            if (confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Å–µ–π—á–∞—Å?')) {
                try {
                    const res = await fetch('/api/bot/trade-now', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const result = await res.json();
                    if (result.success) {
                        alert('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω!');
                        loadStatus();
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
                    }
                } catch (e) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + e.message);
                }
            }
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        populatePairs();
    </script>
</body>
</html>
